<!DOCTYPE html>
<html>

<head>
    <title>Local Posters Plugin Configuration</title>
</head>

<body>
<div data-role="page" class="page type-interior pluginConfigurationPage tbsConfigurationPage"
     data-require="emby-input,emby-button">
    <div data-role="content">
        <div class="content-primary">
            <form class="tbsConfigurationPage">
                <div class="sectionTitleContainer flex align-items-center">
                    <h2 class="sectionTitle">Local Posters Configuration</h2>
                </div>
                <div class="verticalSection">
                    <p>Manage the folder paths for your local posters. You can add or remove folders.</p>
                    <br/>
                </div>

                <div class="checkboxContainer checkboxContainer-withDescription advanced"><label class="emby-checkbox-label"> <input
                    type="checkbox" is="emby-checkbox" class="chkEnableRealtimeMonitor emby-checkbox" checked="checked"
                    data-embycheckbox="true" id="enableBorderReplacerCheckbox" onchange="toggleBorderReplacer()"> <span
                    class="checkboxLabel">Enable border replacing</span>
                    <span
                        class="checkboxOutline"><span class="material-icons checkboxIcon checkboxIcon-checked check"
                                                      aria-hidden="true"></span><span
                        class="material-icons checkboxIcon checkboxIcon-unchecked " aria-hidden="true"></span></span></label>
                    <div class="fieldDescription checkboxFieldDescription">Change a border based on the settings below.
                    </div>
                </div>

                <div class="checkboxContainer checkboxContainer-withDescription advanced"><label class="emby-checkbox-label"> <input
                    type="checkbox" is="emby-checkbox" class="chkEnableRealtimeMonitor emby-checkbox" checked="checked"
                    data-embycheckbox="true" id="removeBorderCheckbox" onchange="toggleBorderColor()"> <span class="checkboxLabel">Enable border removing</span>
                    <span
                        class="checkboxOutline"><span class="material-icons checkboxIcon checkboxIcon-checked check"
                                                      aria-hidden="true"></span><span
                        class="material-icons checkboxIcon checkboxIcon-unchecked " aria-hidden="true"></span></span></label>
                    <div class="fieldDescription checkboxFieldDescription">Remove border from the poster image.
                    </div>
                </div>

                <div class="selectContainer">
                    <label>
                        Border Color: <input is="emby-input" type="color" id="borderColorPicker">
                    </label>
                </div>
                <br/>

                <div class="folders">
                    <div style="display: flex; align-items: center;">
                        <h1>Folders</h1>
                        <button is="emby-button" type="button" class="fab btnAddFolder submit emby-button" title="Add"
                                onclick="toggleFolderInput()">
                            <span class="material-icons add" aria-hidden="true"></span>
                        </button>
                    </div>

                    <div id="folderInputContainer" style="display: none; margin-top: 10px;">
                        <input type="text" id="newFolder" class="emby-input" placeholder="Enter folder path">
                        <button is="emby-button" type="button" class="raised button-submit emby-button"
                                onclick="addFolder()">
                            <span>Add</span>
                        </button>
                    </div>

                    <div id="divFolders" class="paperList folderList" style="margin-bottom:2em"></div>
                </div>

                <button is="emby-button" type="button" class="raised button-submit block emby-button"
                        id="saveFoldersButton" onclick="save()">
                    <span>Save</span>
                </button>
            </form>
        </div>
    </div>

    <script type="text/javascript">
        var pluginId = "3938fe98-b7b2-4333-b678-c4c4e339d232";
        var config = {Folders: [], EnableBorderReplacer: true, RemoveBorder: true, BorderColor: "#000000"};

        ApiClient.getPluginConfiguration(pluginId).then(function (savedConfig) {
            if (savedConfig) {
                config = savedConfig;
            }
            document.getElementById("enableBorderReplacerCheckbox").checked = config.EnableBorderReplacer || false;
            document.getElementById("removeBorderCheckbox").checked = config.RemoveBorder || false;
            document.getElementById("borderColorPicker").value = config.BorderColor || "#000000";
            toggleBorderReplacer();
            loadFolders();
        });

        function loadFolders() {
            var page = $.mobile.activePage;
            var html = '';

            config.Folders.forEach(function (folder, index) {
                html += '<div class="listItem listItem-border lnkPath" data-index="' + index + '">' +
                    '<div class="listItemBody">' +
                    '<h3 class="listItemBodyText">' + folder + '</h3>' +
                    '</div>' +
                    '<button type="button" is="paper-icon-button-light" class="btnSortableMoveUp btnSortable paper-icon-button-light" title="Up" onclick="moveFolderUp(' + index + ')">' +
                    '<span class="material-icons keyboard_arrow_up" aria-hidden="true"></span></button>' +
                    '<button type="button" is="paper-icon-button-light" class="btnSortableMoveDown btnSortable paper-icon-button-light" title="Down" onclick="moveFolderDown(' + index + ')">' +
                    '<span class="material-icons keyboard_arrow_down" aria-hidden="true"></span></button>' +
                    '<button type="button" is="paper-icon-button-light" class="btnRemovePath paper-icon-button-light" title="Remove" onclick="removeFolder(' + index + ')">' +
                    '<span class="material-icons remove_circle" aria-hidden="true"></span></button>' +
                    '</div>';
            });

            $('#divFolders', page).html(html).trigger('create');
        }

        function addFolder() {
            var folderInput = $('#newFolder').val().trim();
            if (folderInput && !config.Folders.includes(folderInput)) {
                config.Folders.push(folderInput);
                $('#newFolder').val('');
                loadFolders();
            }
        }

        function removeFolder(index) {
            if (config.Folders[index]) {
                config.Folders.splice(index, 1);
                loadFolders();
            }
        }

        function moveFolderUp(index) {
            if (index > 0) {
                [config.Folders[index], config.Folders[index - 1]] = [config.Folders[index - 1], config.Folders[index]];
                loadFolders();
            }
        }

        function moveFolderDown(index) {
            if (index < config.Folders.length - 1) {
                [config.Folders[index], config.Folders[index + 1]] = [config.Folders[index + 1], config.Folders[index]];
                loadFolders();
            }
        }

        function save() {
            config.EnableBorderReplacer = document.getElementById("enableBorderReplacerCheckbox").checked;
            config.RemoveBorder = document.getElementById("removeBorderCheckbox").checked;
            config.BorderColor = document.getElementById("borderColorPicker").value;
            ApiClient.updatePluginConfiguration(pluginId, config).then(function () {
                Dashboard.alert("Configuration Updated Successfully");
            }).catch(function (err) {
                Dashboard.alert({message: "Unexpected error occurred!"});
            });
        }

        function toggleFolderInput() {
            var inputContainer = document.getElementById("folderInputContainer");
            inputContainer.style.display = inputContainer.style.display === "none" ? "block" : "none";
        }

        function toggleBorderReplacer() {
            document.getElementById("removeBorderCheckbox").disabled = !document.getElementById("enableBorderReplacerCheckbox").checked;

            toggleBorderColor()
        }

        function toggleBorderColor() {
            document.getElementById("borderColorPicker").disabled = !document.getElementById("enableBorderReplacerCheckbox").checked || document.getElementById("removeBorderCheckbox").checked;
        }
    </script>
</div>
</body>
</html>
